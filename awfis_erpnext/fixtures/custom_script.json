[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Lead", 
  "modified": "2017-03-21 02:56:38.271332", 
  "name": "Lead-Client", 
  "script": "frappe.ui.form.on(\"Lead Awfis Centre\", \"centre_city\", function(frm, cdt, cdn){\n  var child = locals[cdt][cdn]; \n  grid_row = cur_frm.fields_dict['lead_awfis_centres'].grid.grid_rows_by_docname[child.name];\n  field = frappe.utils.filter_dict(grid_row.docfields, {fieldname: \"centre\"})[0]\n  field.get_query = function(){\n    return {\n       filters: { city: child.centre_city }\n    }\n  }\n});\n\nfrappe.ui.form.on(\"Lead\", \"validate\", function(frm){\n  if(!isMobileNoValid(frm.doc.mobileno||\"\")||!isMobileNoValid(frm.doc.alt_mobile_no_1||\"\")||!isMobileNoValid(frm.doc.alt_mobile_no_2||\"\")) {\n        flashMessage();\n        validated = false;\n  }\n});\n\nfunction isMobileNoValid(mobno) {\n    return (mobno.length <= 15);\n}\n\nfunction flashMessage() {\n       msgprint(__(\"Please check the value for Mobile No.\", \"Invalid Mobile No\"));\n}\n\nfrappe.ui.form.on(\"Lead\", \"onload\", function(frm) {\n    frm.set_query(\"channel_partner\", function() {\n      return {\n      \"filters\": {\n                \"partner_type\": frm.doc.source\n            }\n        };\n    });\n    frm.set_query( \"awfis_lead_territory\", function() {\n      return {\n      \"filters\": {\n                \"is_group\": \"No\"\n            }\n        };\n    });\n    \n    if ((frappe.boot.user.roles != \"Awfis Ops User\") && (frm.doc.__islocal)) {\n      var dialog = new frappe.ui.Dialog({\n        title: __(\"Lookup Lead\"),\n        fields: [\n          {\"fieldtype\": \"Data\", \"label\": __(\"Caller Number\"), \"fieldname\": \"caller_number\",\n            \"reqd\": 1 },\n          {\"fieldtype\": \"Button\", \"label\": __(\"Search\"), \"fieldname\": \"search_lead\"},\n        ],\n\n      });\n\n      dialog.fields_dict.search_lead.$input.click(function() { \n          args = dialog.get_values();\n          \n          frappe.call({\n            method: \"awfis_erpnext.awfis_erpnext.api.lookup_lead\",\n            args: {\n                caller_number: args.caller_number\n            },\n            callback: function(r) {\n              if (!r || !r.message) {\n                  frappe.show_alert(\"No value returned.\");\n              } else if (r.message == \"New Lead\") {\n                  frappe.show_alert(\"No existing Lead with that number.\", 5);\n                  cur_frm.set_value(\"awfis_mobile_no\", args.caller_number)\n                  dialog.hide();\n              } else {\n                  frappe.set_route(\"Form\", \"Lead\", r.message);  \n                  dialog.hide();\n                  cur_frm.refresh();\n              }\n            }\n          })\n        });\n        dialog.show();\n      }\n\n\n});\n\n//Set FirstName and LastName\nfrappe.ui.form.on(\"Lead\", \"first_name\", function(frm){\n    frm.set_value(\"lead_name\", buildName(frm.doc.first_name, frm.doc.last_name));\n});\n\nfrappe.ui.form.on(\"Lead\", \"last_name\", function(frm){\n    frm.set_value(\"lead_name\", buildName(frm.doc.first_name, frm.doc.last_name));\n});\n\n//Lead Name cannot be hidden via Customize Form. Hide using script.\nfrappe.ui.form.on(\"Lead\", \"refresh\", function(frm) {\n    frm.toggle_display(\"lead_name\", false);\n    frm.toggle_display(\"lead_name\", false);\n    \n    //Set sources by channel. \n    var sources_by_channel = { \n      \"Sales Team\" : [\"Referral\", \"Marketing\", \"Broker\"], \n      \"Centre Walk-in\": [\"Outdoor\", \"Online\", \"Referral\", \"Marketing\"],\n      \"Call Centre\": [\"Outdoor\", \"Online\", \"Referral\", \"Marketing\", \"Returning Customer\", \"NA\"],\n      \"Inbound\": [\"Email\", \"SEM\", \"Online\", \"Instant Office\", \"Listings\"]\n    } \n\n    var campaigns_by_sub_source = {\n      \"Events\" : [\"Internal\", \"External\"],\n      \"Social Media\": [\"Facebook\", \"Twitter\", \"Instagram\", \"Youtube\", \"Google\", \"Linkedin\"],\n      \"Online Listing\": [\"99Acres\", \"Magic Bricks\", \"CoWorkable\", \"Work Spot\", \"Space Hiring\"],\n      \"Advertising\": [\"TV\", \"Radio\", \"Theatre\", \"Print\"],\n      \"Friend/Colleague\": [\"Word of Mouth\"]\n    }\n\n    cur_frm.set_query(\"source\", function() {\n      return {\n        \"filters\": [\n          [\"Lead Source\", \"name\", \"in\", sources_by_channel[cur_frm.doc.awfis_lead_channel]]\n         ]\n      }\n    });\n\n    cur_frm.set_query(\"awfis_lead_sub_source\", function() {\n      if ((cur_frm.doc.awfis_lead_channel == \"Inbound\") && (cur_frm.doc.source == \"Online\")) {\n        return {\n          \"filters\": [\n            [\"Lead Source\", \"name\", \"=\", \"Social Media\"]\n           ]\n        }\n      } else {\n        return {\n          \"filters\": [\n            [\"Lead Source\", \"awfis_lead_source_parent\", \"=\", cur_frm.doc.source]\n           ]\n        }\n      }\n    });\n\n    cur_frm.set_query(\"campaign_name\", function() {\n      if ((cur_frm.doc.awfis_lead_channel == \"Sales Team\") && (cur_frm.doc.source == \"Marketing\")) {\n        return {\n          \"filters\": [\n            [\"Campaign\", \"name\", \"in\", [\"Email\", \"Cold Calling\"]]\n           ]\n        }\n      } else {\n        return {\n          \"filters\": [\n            [\"Campaign\", \"name\", \"in\", campaigns_by_sub_source[cur_frm.doc.awfis_lead_sub_source] || []]\n           ]\n        }\n      }\n    });  \n    set_field_visibility();\n\n    //Hide mobile no in modify mode.\n    frm.set_df_property(\"awfis_mobile_no\", \"read_only\", frm.doc.__islocal ? 0 : 1);\n    frm.set_df_property(\"lead_owner\", \"read_only\", 1);\n});\n\n//Set value of Mobile No when Awfis Mobile No is entered.\nfrappe.ui.form.on(\"Lead\", \"awfis_mobile_no\", function(frm) {\n    frm.set_value(\"mobile_no\", frm.doc.awfis_mobile_no);\n});\n\n//Set value of Mobile No when Awfis Mobile No is entered.\nfrappe.ui.form.on(\"Lead\", \"awfis_company_website\", function(frm) {\n    frm.set_value(\"website\", frm.doc.awfis_company_website);\n});\n\n//Set value of Mobile No when Awfis Mobile No is entered.\nfrappe.ui.form.on(\"Lead\", \"awfis_email_id\", function(frm) {\n    frm.set_value(\"email_id\", frm.doc.awfis_email_id);\n});\n\n//Set value of Territory when Awfis Lead Territory is set.\nfrappe.ui.form.on(\"Lead\", \"awfis_lead_territory\", function(frm) {\n    frm.set_value(\"territory\", frm.doc.awfis_lead_territory);\n});\n\n//Helpers\nfunction buildName(fname, lname) {\n  if (!lname) {\n    return fname;\n  } else if (!fname) {\n    return lname;\n  } else {\n    return fname + ' ' + lname;\n  }\n}\n\nfrappe.ui.form.on(\"Lead Awfis Space\", \"space_type\", function(frm, cdt, cdn) {\n   var space = locals[cdt][cdn];\n   if (space.space_type == \"Desk-Fixed\" || space.space_type == \"Desk-Flexi\") {\n      space.capacity = 1;\n      set_capacity_property_readonly(1);\n   } else {\n      space.capacity = \"\";\n      set_capacity_property_readonly(0);\n   }\n   refresh_field(\"awfis_spaces\"); \n});\n\nfunction set_capacity_property_readonly(state) {\n    var df = frappe.meta.get_docfield(\"Lead Awfis Space\",\"capacity\", cur_frm.doc.name);\n    df.read_only = state;\n}\n\nfrappe.ui.form.on(\"Lead\", \"source\", function(frm) {\n  if (frm.doc.source === \"IPC\" || frm.doc.source === \"Broker\" ){\n      frm.set_value(\"type\", \"Channel Partner\");\n  } else{\n      frm.set_value(\"type\", \"\");\n  }\n  cur_frm.set_value(\"awfis_lead_sub_source\", \"\");\n  cur_frm.set_value(\"campaign_name\", \"\");\n  set_field_visibility();\n});\n\nfrappe.ui.form.on(\"Lead\", \"awfis_lead_channel\", function(frm) {\n    cur_frm.set_value(\"source\", \"\");\n    cur_frm.set_value(\"awfis_lead_sub_source\", \"\");\n    cur_frm.set_value(\"campaign_name\", \"\");\n    set_field_visibility();\n});\n\nfrappe.ui.form.on(\"Lead\", \"awfis_lead_sub_source\", function(frm) {\n    cur_frm.set_value(\"campaign_name\", \"\");\n    set_field_visibility();\n});\n\nfunction set_field_visibility() {\n  \n  if (cur_frm.doc.awfis_lead_channel == \"Sales Team\") {\n    cur_frm.set_df_property(\"awfis_lead_sub_source\", \"hidden\", [\"Referral\", \"Broker\"].indexOf(cur_frm.doc.source) == -1);\n  } else if (cur_frm.doc.awfis_lead_channel == \"Call Centre\") {\n    cur_frm.set_df_property(\"awfis_lead_sub_source\", \"hidden\", [\"Returning Customer\", \"NA\"].indexOf(cur_frm.doc.source) != -1);\n  } else {\n    cur_frm.set_df_property(\"awfis_lead_sub_source\", \"hidden\", 0);\n  }\n\n  \n  if (cur_frm.doc.awfis_lead_channel == \"Sales Team\") {\n    cur_frm.set_df_property(\"campaign_name\", \"hidden\", (cur_frm.doc.source != \"Marketing\"));  \n  } else if ([\"Events\", \"Social Media\", \"Online Listing\", \"Advertising\", \"Friend/Colleague\"].indexOf(cur_frm.doc.awfis_lead_sub_source) == -1) {\n    cur_frm.set_df_property(\"campaign_name\", \"hidden\", 1);\n  } else {\n    cur_frm.set_df_property(\"campaign_name\", \"hidden\", 0);\n  }\n\n  cur_frm.set_df_property(\"channel_partner\", \"hidden\", cur_frm.doc.awfis_lead_channel == \"Sales Team\");\n}\n\n\n\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Contact", 
  "modified": "2016-04-11 13:11:34.248650", 
  "name": "Contact-Client", 
  "script": "var is_mobno_valid = false;\n\nfrappe.ui.form.on(\"Contact\", \"mobile_no\", function(frm){\n\tvar mobno = frm.doc.mobile_no;\n\tvar rx = new RegExp(\"^[789]\\\\d{9}$\"); \n\tvar isvalid = rx.test(mobno);\n\n\tif (isvalid == true) {\n          is_mobno_valid = true;\n\t} else {\n          is_mobno_valid = false;\n\t  msgprint(\"Entered Mobile No. is either incomplete or invalid. <br /> Tip: Add it without the +0 or +91 at the beginning.\", \"Invalid Mobile No\");\n\t}\n});\n\nfrappe.ui.form.on(\"Contact\", \"validate\", function(frm) {\n   if (!is_mobno_valid) {\n       msgprint(\"Entered Mobile No. is either incomplete or invalid. <br /> Tip: Add it without the +0 or +91 at the beginning.\", \"Invalid Mobile No\");\n      validated = false;\n   }\n\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2016-04-13 21:09:34.469728", 
  "name": "Customer-Client", 
  "script": "frappe.ui.form.on(\"Customer\", \"company_website\", function(frm){\n \tfrm.set_value(\"website\", frm.doc.company_website);\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item Attribute", 
  "modified": "2016-04-19 00:59:07.057389", 
  "name": "Item Attribute-Client", 
  "script": "cur_frm.add_fetch(\"awfis_centre\", \"centre_name\", \"attribute_value\");\ncur_frm.add_fetch(\"awfis_centre\", \"abbreviation\", \"abbr\");", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Material Request", 
  "modified": "2016-10-04 19:25:07.984146", 
  "name": "Material Request-Client", 
  "script": "//Allow only material transfers when user has just Stock User in roles.\n//Length == 3: user_roles=[\"Stock User\", \"All\", \"Guest\"]\nfrappe.ui.form.on('Material Request', 'validate', function(frm){\n\tif ((user_roles.length == 3) && (user_roles[0] == \"Stock User\")) {\n\t\tif (cur_frm.doc.material_request_type != \"Material Transfer\") {\n\t\t\tvalidated=false;\n\t\t\tfrappe.msgprint('Not allowed.');\n\t\t}\n\t}\n});", 
  "script_type": "Client"
 }
]